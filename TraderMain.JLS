[JLScript]
Version=1
Name=TraderMain
Notes=
Encrypted=false
LogRowsCount=300
Data="var variablePath = \"C:\\\\Users\\\\Damjan\\\\Documents\\\\GitHub\\\\qt-bitcoin-trader-scripts\\\\BTCIOT\\\\\";\n\n///////////////\t\tlog to file or window\t\t///////////////////\nvar logToFile = true;\nvar logToWindow = true;\nvar logFile = variablePath + \"TraderMainLogger.txt\";\n\nfunction eventLogger(tempString) {\n    if (logToFile)\n        trader.fileAppend(logFile, trader.dateTimeString() + \": \" + tempString);\n    if (logToWindow)\n        trader.log(tempString);\n}\n\n\nvar lastTradeStatusFile = variablePath + \"lastTradeStatusFile.txt\";\n\neventLogger(\"///////////////////////        START - TRADER MAIN       ///////////////////\");\n///////////////////////////////////////////////////////////////////\nlastMyBuyPrice();\ntrader.timer(57, \"lastMyBuyPrice()\");\n///////////////////////////////////////////////////////////////////\nvar currencyPrimary = \"BTC\";\nvar currencySecondary = \"IOT\";\n\nvar scriptName = \"\";\nvar lastSaleFile = variablePath + \"lastSale.txt\";\nvar lastMySellPriceOld = trader.get(\"LastMySellPrice\");\neventLogger(scriptName + \".lastMySellPrice: \" + lastMySellPriceOld);\ntrader.fileWrite(lastSaleFile, lastMySellPriceOld);\n\n///////////////////////////////////////////////////////////////////\n//var lastCurrencySecondaryBallanceFile = variablePath + \"lastCurrencySecondaryBallance.txt\";\nvar currencySecondaryBalance = trader.get(\"Balance\", currencySecondary);\neventLogger(scriptName + \".currencySecondaryBalance: \" + currencySecondaryBalance);\n//trader.fileWrite(lastCurrencySecondaryBallanceFile, currencySecondaryBalance);\n\n///////////////////////////////////////////////////////////////////\nvar bidPriceFile = variablePath + \"bidPrice.txt\";\nvar bidPrice = trader.get(\"BidPrice\");\neventLogger(scriptName + \".bidPrice: \" + bidPrice);\ntrader.fileWrite(bidPriceFile, bidPrice);\n\nvar openBidsCount = 0;\nvar openAsksCount = trader.get(\"OpenAsksCount\");\nvar openAsksCountOld = openAsksCount;\n\neventLogger(scriptName + \".Restart Trader\");\ntrader.groupStop(\"Trader\");\ntrader.groupStart(\"Trader\");\n\ntrader.timer(41, \"restartEverything()\");\n\nfunction restartEverything() {\n    var scriptName = \"restartEverything()\";\n    eventLogger(scriptName + \".START\");\n    \n    openAsksCount = trader.get(\"OpenAsksCount\");\n    var lastMySellPrice = trader.get(\"LastMySellPrice\");\n    eventLogger(scriptName + \".lastMySellPriceOld: \" + lastMySellPrice);\n    eventLogger(scriptName + \".lastMySellPrice: \" + lastMySellPriceOld);\n    eventLogger(scriptName + \".openAsksCount: \" + openAsksCount);\n    eventLogger(scriptName + \".openAsksCountOld: \" + openAsksCountOld);\t\n\t\n\tif(openAsksCount < openAsksCountOld)\n\t{\t\t\n\t\t\teventLogger(scriptName + \".STEP0\");\n\t\t\trestartTraderMainRestart();\n\t}\n\t\n    if (lastMySellPrice != lastMySellPriceOld) {\n        eventLogger(scriptName + \".STEP1\");        \n        restartTraderMainRestart();\n\t\t\t\t\t\t\t\t\t\t\t  \n\t\t\t\t\t\t\t\t\t\t\t   \n    } else {\n        eventLogger(scriptName + \".STEP2\");\n        bidPrice = trader.get(\"BidPrice\");\n        eventLogger(scriptName + \".bidPrice: \" + bidPrice);\n        trader.fileWrite(bidPriceFile, bidPrice);\n\n        currencySecondaryBalance = trader.get(\"Balance\", currencySecondary);\n        eventLogger(scriptName + \".currencySecondaryBalance: \" + currencySecondaryBalance);\n        //trader.fileWrite(lastCurrencySecondaryBallanceFile, currencySecondaryBalance);\n\n        openBidsCount = trader.get(\"OpenBidsCount\");\n        openAsksCount = trader.get(\"OpenAsksCount\");\n        eventLogger(scriptName + \".openBidsCount: \" + openBidsCount);\n        eventLogger(scriptName + \".openAsksCount: \" + openAsksCount);\n        eventLogger(scriptName + \".openAsksCountOld: \" + openAsksCountOld);\n\n        \n        if ((((openAsksCount < openAsksCountOld) || (openAsksCount == openAsksCountOld && lastMySellPriceOld != 0)) && lastMySellPriceOld != lastMySellPrice)) {\n        \n            eventLogger(scriptName + \".STEP3\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t  \n            lastMySellPriceOld = lastMySellPrice;\n            trader.fileWrite(lastSaleFile, lastMySellPriceOld);            \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   \n            trader.cancelBids(currencySecondary + currencyPrimary);\n            restartTraderMainRestart();\n\t\t\t\t\t\t\t\t\t\t\t\t   \n        }\n\t\t\t\t\t\t\t\t\t\t \n    }\n\topenAsksCountOld = openAsksCount;\n    eventLogger(scriptName + \".END\");\n}\n\nfunction restartTraderMainRestart()\n{\n\tvar scriptName = \"restartTraderMainRestart()\";\n    eventLogger(scriptName + \".START\");\n    eventLogger(scriptName + \"./#/#/#/#////////////   RESTART   ////////////////////\");\n    eventLogger(scriptName + \".SELL.lastTradeStatusFile\");\n    trader.fileWrite(lastTradeStatusFile, \"SELL\");\n    eventLogger(scriptName + \".STOP.TraderMainRestart\");\n    trader.groupStop(\"TraderMainRestart\");\n    eventLogger(scriptName + \".STOP.Trader\");\n    trader.groupStop(\"Trader\");\n    eventLogger(scriptName + \".START.TraderMainRestart\");\t\n    trader.groupStart(\"TraderMainRestart\");\n    eventLogger(scriptName + \".Start.TraderMain\");\n\ttrader.groupStop(\"TraderMain\");\n\t\n\teventLogger(scriptName + \".END\");\n}\n\nfunction lastMyBuyPrice() {\n    var scriptName = \"lastMyBuyPrice()\";\n    eventLogger(scriptName + \".START\");\n    trader.groupStop(\"TraderLastBuy\");\n    trader.groupStart(\"TraderLastBuy\");\n    eventLogger(scriptName + \".END\");\n}"
